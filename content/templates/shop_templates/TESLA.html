{% extends 'layouts/default/page.html' %}
{% load static %}
{% load bootstrap4 %}
{% load i18n %}




{% block content %}
    <style type="text/css">
        body {
            font-family: Monospace;
            color: #fff;
            margin: 0px;
            overflow: hidden;
            background-color: #a19a9a;
            background-size: cover;
            -moz-background-size: cover;
            -webkit-background-size: cover;
            -o-background-size: cover;
        }

        html, body {
            margin: 0;
            padding: 0;
        }

        /* 进度条 */
        .progress {
            position: fixed;
        }

        .progress .mask {
            position: absolute;
            background: rgba(0, 0, 0, 0.2);
            z-index: 99;
        }

        .progress .loading {
            width: 30em;
            height: 1em;
            background: #fff;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            border-radius: 1em;
        }

        .progress .trends {
            width: 0;
            height: 100%;
            background: red;
            box-shadow: 1px 1px 10px red;
            border-radius: 1em;
            transition: .3s --progress;
        }

    </style>
    <style>
        .left-box {
            background: #a52c644a;
            text-align: center;
            padding-top: 100px;
            padding-bottom: 100px;
            height: 500px;
        }
    </style>
    <div class="container" style="height: 700px">
        <div class="row" style="height: 100%">
            <div class="col-8 border">
                <div class="container left-box">
                    <div id="progress" class="progress col-6">
                        <div class="mask"></div>
                        <div class="loading">
                            <div class="trends"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4 border">
                <div class="group--detail-container">
                    <div class="child-group--option_details tds--vertical_padding tds-flex tds-flex--row-nowrap tds-flex--center tds-flex--justify-center">
                        <div class="observer-placeholder" onclick="changeModel(0)" style="height: 100%;">
                            <input class="tds-btn tds-btn--link group--options_asset--container group--option--selected"
                                   data-id="$IBE00-option" data-id-selected="true" id="INTERIOR_PACKAGE_$IBE00"
                                   type="radio" aria-label="全黑色 - 包括" name="INTERIOR_PACKAGE" value="$IBE00"
                                   checked="">
                            <label class="group--option--label" for="INTERIOR_PACKAGE_$IBE00">
                                <span class="tds--is_visually_hidden">全黑色</span>
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg"
                                     class="asset-loader--svg-container asset-loader-2 group--options_asset selected"
                                     id="Model_S_全黑色"
                                     style="overflow: hidden; cursor: inherit; opacity: 1; transform: scale(1); height: 54px;">
                                    <title id="Model_S_全黑色">全黑色</title>
                                    <defs>
                                        <clipPath
                                                id="clip_https:__static-assets.tesla.cn_share_tesla_design_studio_assets_MODEL3_UI_Interior_Black.png_version_v0027d202203031319">
                                            <circle cx="50%" cy="50%" r="24" fill="#FFFFFF" stroke="#3E6AE1"
                                                    stroke-width="0"></circle>
                                        </clipPath>
                                        <filter id="filter_https:__static-assets.tesla.cn_share_tesla_design_studio_assets_MODEL3_UI_Interior_Black.png_version_v0027d202203031319"
                                                height="200%">
                                            <feGaussianBlur in="SourceAlpha" stdDeviation="1"></feGaussianBlur>
                                            <feComponentTransfer>
                                                <feFuncA type="linear" slope="0.3"></feFuncA>
                                            </feComponentTransfer>
                                            <feOffset dx="1.3" dy="1.5" result="offsetblur"></feOffset>
                                            <feMerge>
                                                <feMergeNode></feMergeNode>
                                                <feMergeNode in="SourceGraphic"></feMergeNode>
                                            </feMerge>
                                        </filter>
                                    </defs>
                                    <image width="40px" height="40px" xmlns:xlink="http://www.w3.org/1999/xlink"
                                           xlink:href="https://static-assets.tesla.cn/share/tesla_design_studio_assets/MODEL3/UI/Interior_Black.png?version=v0027d202203031319"
                                           preserveAspectRatio="xMidYMid meet" alt="全黑色" x="7px" y="7px"
                                           clip-path="url(#clip_https://static-assets.tesla.cn/share/tesla_design_studio_assets/MODEL3/UI/Interior_Black.png?version=v0027d202203031319)"></image>
                                </svg>
                            </label>
                        </div>
                        <div class="observer-placeholder" onclick="changeModel(1)" style="height: 100%;">
                            <input class="tds-btn tds-btn--link group--options_asset--container"
                                   data-id="$IWW00-option"
                                   data-id-selected="false" id="INTERIOR_PACKAGE_$IWW00" type="radio"
                                   aria-label="黑色和白色 - 包括" name="INTERIOR_PACKAGE" value="$IWW00">
                            <label class="group--option--label" for="INTERIOR_PACKAGE_$IWW00">
                                <span class="tds--is_visually_hidden">黑色和白色</span>
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg"
                                     class="asset-loader--svg-container asset-loader-2 group--options_asset shadow"
                                     id="Model_S_黑色和白色"
                                     style="overflow: hidden; cursor: inherit; opacity: 1; transform: scale(1); height: 54px;">
                                    <title id="Model_S_黑色和白色">黑色和白色</title>
                                    <defs>
                                        <clipPath
                                                id="clip_https:__static-assets.tesla.cn_share_tesla_design_studio_assets_MODEL3_UI_Interior_White.png_version_v0027d202203031319">
                                            <circle cx="50%" cy="50%" r="24" fill="#FFFFFF" stroke="#3E6AE1"
                                                    stroke-width="0"></circle>
                                        </clipPath>
                                        <filter id="filter_https:__static-assets.tesla.cn_share_tesla_design_studio_assets_MODEL3_UI_Interior_White.png_version_v0027d202203031319"
                                                height="200%">
                                            <feGaussianBlur in="SourceAlpha" stdDeviation="1"></feGaussianBlur>
                                            <feComponentTransfer>
                                                <feFuncA type="linear" slope="0.3"></feFuncA>
                                            </feComponentTransfer>
                                            <feOffset dx="1.3" dy="1.5" result="offsetblur"></feOffset>
                                            <feMerge>
                                                <feMergeNode></feMergeNode>
                                                <feMergeNode in="SourceGraphic"></feMergeNode>
                                            </feMerge>
                                        </filter>
                                    </defs>
                                    <image width="40px" height="40px" xmlns:xlink="http://www.w3.org/1999/xlink"
                                           xlink:href="https://static-assets.tesla.cn/share/tesla_design_studio_assets/MODEL3/UI/Interior_White.png?version=v0027d202203031319"
                                           preserveAspectRatio="xMidYMid meet" alt="黑色和白色" x="7px" y="7px"
                                           clip-path="url(#clip_https://static-assets.tesla.cn/share/tesla_design_studio_assets/MODEL3/UI/Interior_White.png?version=v0027d202203031319)"></image>
                                </svg>
                            </label></div>
                        <div class="observer-placeholder" onclick="changeModel(2)" style="height: 100%;">
                            <input
                                    class="tds-btn tds-btn--link group--options_asset--container"
                                    data-id="$ICW00-option"
                                    data-id-selected="false" id="INTERIOR_PACKAGE_$ICW00" type="radio"
                                    aria-label="米色 - 包括"
                                    name="INTERIOR_PACKAGE" value="$ICW00">
                            <label class="group--option--label"
                                   for="INTERIOR_PACKAGE_$ICW00"><span
                                    class="tds--is_visually_hidden">米色</span>
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg"
                                     class="asset-loader--svg-container asset-loader-2 group--options_asset shadow"
                                     id="Model_S_米色"
                                     style="overflow: hidden; cursor: inherit; opacity: 1; transform: scale(1); height: 54px;">
                                    <title id="Model_S_米色">米色</title>
                                    <defs>
                                        <clipPath
                                                id="clip_https:__static-assets.tesla.cn_share_tesla_design_studio_assets_MODEL3_UI_Interior_Cream.png_version_v0027d202203031319">
                                            <circle cx="50%" cy="50%" r="24" fill="#FFFFFF" stroke="#3E6AE1"
                                                    stroke-width="0"></circle>
                                        </clipPath>
                                        <filter id="filter_https:__static-assets.tesla.cn_share_tesla_design_studio_assets_MODEL3_UI_Interior_Cream.png_version_v0027d202203031319"
                                                height="200%">
                                            <feGaussianBlur in="SourceAlpha" stdDeviation="1"></feGaussianBlur>
                                            <feComponentTransfer>
                                                <feFuncA type="linear" slope="0.3"></feFuncA>
                                            </feComponentTransfer>
                                            <feOffset dx="1.3" dy="1.5" result="offsetblur"></feOffset>
                                            <feMerge>
                                                <feMergeNode></feMergeNode>
                                                <feMergeNode in="SourceGraphic"></feMergeNode>
                                            </feMerge>
                                        </filter>
                                    </defs>
                                    <image width="40px" height="40px" xmlns:xlink="http://www.w3.org/1999/xlink"
                                           xlink:href="https://static-assets.tesla.cn/share/tesla_design_studio_assets/MODEL3/UI/Interior_Cream.png?version=v0027d202203031319"
                                           preserveAspectRatio="xMidYMid meet" alt="米色" x="7px" y="7px"
                                           clip-path="url(#clip_https://static-assets.tesla.cn/share/tesla_design_studio_assets/MODEL3/UI/Interior_Cream.png?version=v0027d202203031319)"></image>
                                </svg>
                            </label>
                        </div>
                        <div class="observer-placeholder" style="height: 100%;"></div>
                        <div class="observer-placeholder" style="height: 100%;"></div>
                        <div class="observer-placeholder" style="height: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

<script type="text/javascript" src="{% static "assets/js/jquery-2.1.4.min.js" %}"></script>
<script type="text/javascript" src="{% static "assets/js_for_model/three.js" %}"></script>
<script type="text/javascript" src="{% static "assets/js_for_model/GLTFLoader.js" %}"></script>
<script type="text/javascript" src="{% static "assets/js_for_model/DDSLoader.js" %}"></script>
<script type="text/javascript" src="{% static "assets/js_for_model/TrackballControls.js" %}"></script>
<script type="text/javascript" src="{% static "assets/js_for_model/Detector.js" %}"></script>

<script>
    // 设置名称
    let fileNames = ["design_guitar (1).gltf", "design_guitar (2).gltf", "design_guitar (3).gltf", "design_guitar (4).gltf"]

    function changeModel(x) {
        let fileName = fileNames[x]
        console.log("Dianji", x);
        {#;#}
        {#// 容器#}
        {#fileNames = [fileNames[x]];#}
        var container,
            // 控制器
            controls;
        // 镜头
        var camera,
            // 场景
            scene,
            // 渲染
            renderer;

        // 检测浏览器兼容
        if (Detector.webgl) {
            //alert('浏览器支持');
            init();
            animate();
        } else {
            alert('浏览器不支持');
        }


        //初始化
        function init() {
            container = document.createElement('div');
            document.body.appendChild(container);
            //创建一个一个视角
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 4000);
            //设置视角离原点的位置（眼睛距离模型的距离）
            camera.position.z = 700;
            //控制器
            controls = new THREE.TrackballControls(camera);
            //设置旋转速度
            controls.rotateSpeed = 3;

            // 使动画循环使用时阻尼或自转 意思是否有惯性
            controls.enableDamping = true;
            //是否可以缩放
            controls.enableZoom = true;
            //是否自动旋转
            controls.autoRotate = true;
            //设置相机距离原点的最远距离
            controls.minDistance = 1;
            //设置相机距离原点的最远距离
            controls.maxDistance = 50;
            //是否开启右键拖拽
            controls.enablePan = true;

            // scene 创建一个场景
            scene = new THREE.Scene();
            // 设置场景背景色
            // scene.background = new THREE.Color( 0xffffff);
            {#scene.fog = new THREE.Fog(0x000, 1000, 4000);#}

            console.log(scene)
            //创建一个环境灯光
            var ambientLight = new THREE.AmbientLight(0xffffff);
            scene.add(ambientLight);
            // 从上到下的平行光
            var direction = new THREE.DirectionalLight(0x666666);
            scene.add(direction);


            var d_light = new THREE.DirectionalLight("#080");

            d_light.castShadow = true;
            d_light.shadowCameraVisible = true;
            d_light.position.set(0, 26, 4);
            scene.add(d_light);

            //把视角放入环境
            scene.add(camera);

            // model  开始创建模型
            //进度通知
            var onProgress = function (xhr) {
                console.log(xhr)
                if (xhr.lengthComputable) {
                    var percentComplete = xhr.loaded / xhr.total * 100;
                    {#console.log(Math.round(percentComplete, 2) + '% downloaded');#}
                    play(Math.round(percentComplete, 2))
                }
            };
            //报错通知
            var onError = function (xhr) {
            };

            // 添加操作器
            console.log("加载文件名", fileName);
            THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());
            let loader = new THREE.GLTFLoader();
            loader.load("{% static "assets/design_model/" %}" + fileName, function (gltf) {
                {#console.log('控制台查看加载gltf文件返回的对象结构', gltf)#}
                {#console.log('gltf对象场景属性', gltf.scene)#}
                {#console.log('gltf对象相机属性', gltf.cameras)#}
                // 返回的场景对象gltf.scene插入到threejs场景中
                gltf.scene.traverse(function (child) {
                    if (child.isMesh) {
                        {#if (child.name.includes('ere')) {#}
                        {#    child.material.color.set("rgb(67, 160, 71)")#}
                        {#\}#}
                        {#console.log("模型部件", child.name);#}
                        child.frustumCulled = false;
                        //模型阴影
                        child.castShadow = true;
                        //模型自发光
                        child.material.emissive = child.material.color;
                        child.material.emissiveMap = child.material.map;
                    }
                });
                {#gltf.position.set(0, 0, 0 );#}
                {#gltf.scene.scale.set(1, 1, 1);#}
                {#let box = new THREE.Box();#}
                {#box.setObjectFrom('物体');#}
                {#console.log("sdasdsad", box.min, box.max);#}
                {#gltf.scene.scale.set(1 * fileNames.indexOf(fileName), 1 * fileNames.indexOf(fileName), 1 * fileNames.indexOf(fileName)) // scale here#}
                scene.add(gltf.scene);
            }, onProgress, onError);


            //创建一个webgl对象
            renderer = new THREE.WebGLRenderer({
                antialias: false,
                alpha: true // 设置透明
            });
            // 设置颜色
            renderer.setClearColor(0xffffff, 0);
            // 设置分辨率
            renderer.setPixelRatio(window.devicePixelRatio);
            // 设置渲染尺寸
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            // 自适应监听
            window.addEventListener('resize', resize, false);
        }

        // 监听窗口自适应
        function resize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // 时刻渲染
        function animate() {
            controls.update();
            renderer.render(scene, camera);
            requestAnimationFrame(animate);

        }

        // 获取参数
        function GetUrlParam(paraName) {
            var url = document.location.toString();
            var arrObj = url.split("?");
            if (arrObj.length > 1) {
                var arrPara = arrObj[1].split("&");
                var arr;
                for (var i = 0; i < arrPara.length; i++) {
                    arr = arrPara[i].split("=");
                    if (arr != null && arr[0] == paraName) {
                        return arr[1];
                    }
                }
                return "";
            } else {
                return "";
            }
        }

        let fake = 0;

        // 这是一个进度条函数进度条函数
        function play(a) {
            while (fake < a) {
                fake = fake + 1;
                document.getElementsByClassName("trends")[0].style.width = fake + "%";
            }
            if (fake < 100) {
                document.getElementById("progress").style.display = "block";
                console.log("a:", a);
            } else {
                document.getElementById("progress").style.display = "none";
            }
        }

    }

</script>


